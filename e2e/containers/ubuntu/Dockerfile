FROM ubuntu:24.04

# Install minimal dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates

# Create test user
RUN useradd -m -s /bin/bash testuser

# Copy toto binary
COPY toto /usr/local/bin/toto
RUN chmod +x /usr/local/bin/toto

# Setup user environment
USER testuser
WORKDIR /home/testuser

# Add ~/.local/bin to PATH
ENV PATH="/home/testuser/.local/bin:${PATH}"

# Copy resource definitions (config.cue will be generated by toto init)
COPY --chown=testuser:testuser config/tools.cue /home/testuser/.config/toto/tools.cue
COPY --chown=testuser:testuser config/runtime.cue /home/testuser/.config/toto/runtime.cue

# Default command
CMD ["toto", "version"]
